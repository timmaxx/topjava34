Subject: [PATCH] 4_10_add_hsqldb
---
Index: pom.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/pom.xml b/pom.xml
--- a/pom.xml	(revision e5543fa3e11b351f7b395e46641209a8c54198c6)
+++ b/pom.xml	(date 1677075802962)
@@ -108,6 +108,12 @@
             <artifactId>postgresql</artifactId>
             <version>${postgresql.version}</version>
         </dependency>
+        <dependency>
+            <groupId>org.hsqldb</groupId>
+            <artifactId>hsqldb</artifactId>
+            <version>2.3.4</version>
+        </dependency>
+
 
         <!--- ORM -->
         <dependency>
Index: src/main/resources/db/initDB_hsql.sql
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/db/initDB_hsql.sql b/src/main/resources/db/initDB_hsql.sql
new file mode 100644
--- /dev/null	(date 1677076078900)
+++ b/src/main/resources/db/initDB_hsql.sql	(date 1677076078900)
@@ -0,0 +1,39 @@
+DROP TABLE user_role IF EXISTS;
+DROP TABLE meal IF EXISTS;
+DROP TABLE users IF EXISTS;
+DROP SEQUENCE global_seq IF EXISTS;
+
+CREATE SEQUENCE GLOBAL_SEQ AS INTEGER START WITH 100000;
+
+CREATE TABLE users
+(
+    id               INTEGER GENERATED BY DEFAULT AS SEQUENCE GLOBAL_SEQ PRIMARY KEY,
+    name             VARCHAR(255)            NOT NULL,
+    email            VARCHAR(255)            NOT NULL,
+    password         VARCHAR(255)            NOT NULL,
+    registered       TIMESTAMP DEFAULT now() NOT NULL,
+    enabled          BOOLEAN   DEFAULT TRUE  NOT NULL,
+    calories_per_day INTEGER   DEFAULT 2000  NOT NULL
+);
+CREATE UNIQUE INDEX users_unique_email_idx
+    ON USERS (email);
+
+CREATE TABLE user_role
+(
+    user_id INTEGER NOT NULL,
+    role    VARCHAR(255) NOT NULL,
+    CONSTRAINT user_roles_idx UNIQUE (user_id, role),
+    FOREIGN KEY (user_id) REFERENCES USERS (id) ON DELETE CASCADE
+);
+
+CREATE TABLE meal
+(
+    id          INTEGER GENERATED BY DEFAULT AS SEQUENCE GLOBAL_SEQ PRIMARY KEY,
+    date_time   TIMESTAMP    NOT NULL,
+    description VARCHAR(255) NOT NULL,
+    calories    INT          NOT NULL,
+    user_id     INTEGER      NOT NULL,
+    FOREIGN KEY (user_id) REFERENCES USERS (id) ON DELETE CASCADE
+);
+CREATE UNIQUE INDEX meal_unique_user_datetime_idx
+    ON meal (user_id, date_time)
\ No newline at end of file
Index: src/main/resources/db/hsqldb.properties
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>ISO-8859-1
===================================================================
diff --git a/src/main/resources/db/hsqldb.properties b/src/main/resources/db/hsqldb.properties
new file mode 100644
--- /dev/null	(date 1677075802944)
+++ b/src/main/resources/db/hsqldb.properties	(date 1677075802944)
@@ -0,0 +1,12 @@
+#database.url=jdbc:hsqldb:file:D:/temp/topjava
+
+database.url=jdbc:hsqldb:mem:topjava
+database.username=sa
+database.password=
+database.driverClassName=org.hsqldb.jdbcDriver
+
+database.init=true
+jdbc.initLocation=classpath:db/initDB_hsql.sql
+jpa.showSql=true
+hibernate.format_sql=true
+hibernate.use_sql_comments=true
\ No newline at end of file
Index: src/main/resources/spring/spring-db.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/spring/spring-db.xml b/src/main/resources/spring/spring-db.xml
--- a/src/main/resources/spring/spring-db.xml	(revision e5543fa3e11b351f7b395e46641209a8c54198c6)
+++ b/src/main/resources/spring/spring-db.xml	(date 1677076199642)
@@ -9,7 +9,10 @@
        http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc.xsd
        http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd">
 
+<!-- Change DB by comment/uncomment property-placeholder -->
+
     <context:property-placeholder location="classpath:db/postgres.properties" system-properties-mode="OVERRIDE"/>
+<!--    <context:property-placeholder location="classpath:db/hsqldb.properties" system-properties-mode="OVERRIDE"/>-->
 
 <!--
     For postgres driver logging
@@ -23,14 +26,14 @@
     <context:component-scan base-package="ru.javawebinar.**.repository.jpa"/>
 
     <jdbc:initialize-database data-source="dataSource" enabled="${database.init}">
-        <jdbc:script location="classpath:db/initDB.sql"/>
+        <jdbc:script location="${jdbc.initLocation}"/>
         <jdbc:script encoding="utf-8" location="classpath:db/populateDB.sql"/>
     </jdbc:initialize-database>
 
     <!--no pooling-->
     <bean id="dataSource"
           class="org.springframework.jdbc.datasource.DriverManagerDataSource">
-        <property name="driverClassName" value="org.postgresql.Driver"/>
+        <property name="driverClassName" value="${database.driverClassName}"/>
         <property name="url" value="${database.url}"/>
         <property name="username" value="${database.username}"/>
         <property name="password" value="${database.password}"/>
Index: src/main/resources/db/postgres.properties
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>ISO-8859-1
===================================================================
diff --git a/src/main/resources/db/postgres.properties b/src/main/resources/db/postgres.properties
--- a/src/main/resources/db/postgres.properties	(revision e5543fa3e11b351f7b395e46641209a8c54198c6)
+++ b/src/main/resources/db/postgres.properties	(date 1677075802953)
@@ -1,8 +1,10 @@
 database.url=jdbc:postgresql://localhost:5432/topjava
 database.username=user
 database.password=password
+database.driverClassName=org.postgresql.Driver
 
 database.init=true
+jdbc.initLocation=classpath:db/initDB.sql
 jpa.showSql=true
 hibernate.format_sql=true
 hibernate.use_sql_comments=true
\ No newline at end of file
